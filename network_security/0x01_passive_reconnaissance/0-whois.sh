#!/bin/bash
whois $1 | awk 'BEGIN{reg=0;adm=0;tch=0}/^Registrant Name:/{reg=1;adm=0;tch=0}/^Admin Name:/{reg=0;adm=1;tch=0}/^Tech Name:/{reg=0;adm=0;tch=1}(reg||adm||tch)&&/^(Registrant|Admin|Tech) (Name|Organization|Street|City|State\/Province|Postal Code|Country|Phone|Phone Ext:|Fax|Fax Ext:|Email):/{sub(/: */,", ");print;if(/Phone,/&&!/Phone Ext:/){prefix=(reg?"Registrant":adm?"Admin":"Tech");print prefix" Phone Ext:, "}if(/^(Registrant|Admin|Tech) Fax, /){prefix=(reg?"Registrant":adm?"Admin":"Tech");print prefix" Fax Ext:, "}}' > $1.csv
